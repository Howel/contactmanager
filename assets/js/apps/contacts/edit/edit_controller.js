// Generated by CoffeeScript 1.7.1
ContactManager.module('ContactsApp.Edit', function(Edit, ContactManager, Backbone, Marionette, $, _) {
  return Edit.Controller = {
    editContact: function(id) {
      var fetchingContact, loadingView;
      loadingView = new ContactManager.Common.Views.Loading({
        title: 'Artificial Loading delay'
      });
      ContactManager.mainRegion.show(loadingView);
      fetchingContact = ContactManager.request('contact:entity', id);
      return $.when(fetchingContact).done(function(contact) {
        var contactView;
        contactView = null;
        if (contact) {
          contactView = new Edit.Contact({
            model: contact
          });
          contactView.on('form:submit', function(data) {
            if (contact.save(data)) {
              return ContactManager.trigger('contact:show', contact.get('id'));
            } else {
              return contactView.triggerMethod('form:data:invalid', contact.validationError);
            }
          });
        } else {
          contactView = new ContactManager.ContactsApp.Show.MissingContact();
        }
        return ContactManager.mainRegion.show(contactView);
      });
    }
  };
});
